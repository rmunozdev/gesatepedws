<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Pedido">
	<insert id="reservar" parameterType="pedido" statementType="CALLABLE" >
		call sp_ws_reservar_pedido( 
			#{codigo,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{fechaSolicitud,javaType=java.util.Date,jdbcType=DATETIMEOFFSET,mode=IN},
			#{numeroReserva,javaType=Integer,jdbcType=INTEGER,mode=IN},
			#{fechaVenta,javaType=java.util.Date,jdbcType=DATETIMEOFFSET,mode=IN},
			#{fechadespacho,javaType=java.util.Date,jdbcType=DATE,mode=IN},
			#{direccionDespachoPedido,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{distritoDespacho.codigo,javaType=String,jdbcType=VARCHAR,mode=IN},
			
			#{cliente.codigo,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{cliente.nombres,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{cliente.apellidos,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{cliente.numeroDNI,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{cliente.telefono,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{cliente.email,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{cliente.direccion,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{cliente.distrito.codigo,javaType=String,jdbcType=VARCHAR,mode=IN},
			
			#{tiendaDespacho.codigo,javaType=String,jdbcType=VARCHAR,mode=IN},
			#{fechaRetiroTienda,javaType=java.util.Date,jdbcType=DATE,mode=IN}
		)
	</insert>
	
	<insert id="agregarDetallesPedido" parameterType="java.util.List">
		INSERT INTO tb_detalle_pedido (
			cod_ped,
			cod_prod,
			cant_prod,
			cod_bod
		) VALUES
		<foreach collection="list" item="detallePedido" index="index"
			open="(" separator="),(" close=")">
			#{detallePedido.pedido.codigo, javaType=String,jdbcType=VARCHAR},
			#{detallePedido.producto.codigo, javaType=String,jdbcType=VARCHAR},
			#{detallePedido.cantidadProducto, javaType=Integer,jdbcType=INTEGER},
			#{detallePedido.bodega.codigo, javaType=String,jdbcType=VARCHAR}
		</foreach>
	
	</insert>
	
	<resultMap type="pedido" id="pedidoRM">
		<result property="codigo" column="cod_ped"/>
	</resultMap>
	
	
	<select id="buscarPorNumeroReserva"
		resultMap="pedidoRM" parameterType="java.lang.Integer">
		select *
		from tb_pedido
		where num_reserv_ped = #{numeroReserva}
	</select>
</mapper>